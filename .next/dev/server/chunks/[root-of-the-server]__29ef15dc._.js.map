{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/db.js"],"sourcesContent":["const mongoose = require(\"mongoose\");\r\nrequire('dotenv').config()\r\n\r\nconst Schema = mongoose.Schema;\r\nconst ObjectId = Schema.ObjectId;\r\n\r\nif (mongoose.connection.readyState === 0) {\r\n    if (process.env.DATABASE) {\r\n        mongoose.connect(process.env.DATABASE)\r\n            .then(() => console.log(\"Connected to DB\"))\r\n            .catch(err => console.error(\"DB Config Error:\", err));\r\n    } else {\r\n        console.warn(\"No DATABASE environment variable found.\");\r\n    }\r\n}\r\n\r\nconst userSchema = new Schema({\r\n    username: String,\r\n    stripeCustomerId: { type: String, default: null },\r\n    subscriptionStatus: { type: String, default: 'free' }, // 'free', 'active', 'canceled', 'past_due'\r\n    subscriptionId: { type: String, default: null },\r\n    subscriptionEndDate: { type: Date, default: null },\r\n    razorpayOrderId: { type: String, default: null },\r\n    razorpayPaymentId: { type: String, default: null }\r\n})\r\nconst replySchema = new Schema({\r\n    reply: String,\r\n    repliedBy: String, // username of the person replying\r\n    repliedAt: { type: Date, default: Date.now }\r\n})\r\n\r\nconst messageSchema = new Schema({\r\n    message: String,\r\n    mood: { type: String, default: 'Serious' },\r\n    userId: ObjectId,\r\n    // Dynamic reactions - can accept any emoji as key\r\n    reactions: { type: Schema.Types.Mixed, default: {} },\r\n    // Replies from the message receiver\r\n    replies: [replySchema],\r\n    // Optional sender metadata if they choose to share hints\r\n    senderMeta: {\r\n        share: { type: Boolean, default: false },\r\n        ip: { type: String, default: null },\r\n        deviceType: { type: String, default: null },\r\n        os: { type: String, default: null },\r\n        userAgent: { type: String, default: null }\r\n    },\r\n    createdAt: { type: Date, default: Date.now }\r\n})\r\n\r\n// Prevent model overwrite error in dev mode\r\nif (mongoose.models.users) delete mongoose.models.users\r\nif (mongoose.models.messages) delete mongoose.models.messages\r\n\r\nconst userModal = mongoose.model(\"users\", userSchema);\r\nconst messageModal = mongoose.model(\"messages\", messageSchema);\r\n\r\nmodule.exports = {\r\n    userModal,\r\n    messageModal\r\n}\r\n"],"names":[],"mappings":"AAAA,MAAM;AACN,+GAAkB,MAAM;AAExB,MAAM,SAAS,SAAS,MAAM;AAC9B,MAAM,WAAW,OAAO,QAAQ;AAEhC,IAAI,SAAS,UAAU,CAAC,UAAU,KAAK,GAAG;IACtC,IAAI,QAAQ,GAAG,CAAC,QAAQ,EAAE;QACtB,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC,QAAQ,EAChC,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC,oBACvB,KAAK,CAAC,CAAA,MAAO,QAAQ,KAAK,CAAC,oBAAoB;IACxD,OAAO;QACH,QAAQ,IAAI,CAAC;IACjB;AACJ;AAEA,MAAM,aAAa,IAAI,OAAO;IAC1B,UAAU;IACV,kBAAkB;QAAE,MAAM;QAAQ,SAAS;IAAK;IAChD,oBAAoB;QAAE,MAAM;QAAQ,SAAS;IAAO;IACpD,gBAAgB;QAAE,MAAM;QAAQ,SAAS;IAAK;IAC9C,qBAAqB;QAAE,MAAM;QAAM,SAAS;IAAK;IACjD,iBAAiB;QAAE,MAAM;QAAQ,SAAS;IAAK;IAC/C,mBAAmB;QAAE,MAAM;QAAQ,SAAS;IAAK;AACrD;AACA,MAAM,cAAc,IAAI,OAAO;IAC3B,OAAO;IACP,WAAW;IACX,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AAEA,MAAM,gBAAgB,IAAI,OAAO;IAC7B,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,SAAS;IAAU;IACzC,QAAQ;IACR,kDAAkD;IAClD,WAAW;QAAE,MAAM,OAAO,KAAK,CAAC,KAAK;QAAE,SAAS,CAAC;IAAE;IACnD,oCAAoC;IACpC,SAAS;QAAC;KAAY;IACtB,yDAAyD;IACzD,YAAY;QACR,OAAO;YAAE,MAAM;YAAS,SAAS;QAAM;QACvC,IAAI;YAAE,MAAM;YAAQ,SAAS;QAAK;QAClC,YAAY;YAAE,MAAM;YAAQ,SAAS;QAAK;QAC1C,IAAI;YAAE,MAAM;YAAQ,SAAS;QAAK;QAClC,WAAW;YAAE,MAAM;YAAQ,SAAS;QAAK;IAC7C;IACA,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AAEA,4CAA4C;AAC5C,IAAI,SAAS,MAAM,CAAC,KAAK,EAAE,OAAO,SAAS,MAAM,CAAC,KAAK;AACvD,IAAI,SAAS,MAAM,CAAC,QAAQ,EAAE,OAAO,SAAS,MAAM,CAAC,QAAQ;AAE7D,MAAM,YAAY,SAAS,KAAK,CAAC,SAAS;AAC1C,MAAM,eAAe,SAAS,KAAK,CAAC,YAAY;AAEhD,OAAO,OAAO,GAAG;IACb;IACA;AACJ"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/pages/api/%5Busername%5D.js"],"sourcesContent":["const { userModal, messageModal } = require('../../db')\r\n\r\nexport default async function handler(req, res) {\r\n  const { method } = req\r\n  const username = req.query.username\r\n  if (method === 'POST') {\r\n    try {\r\n      const { message, mood = 'Serious', shareMeta = false } = req.body\r\n      if (!message) return res.status(400).json({ error: 'message required' })\r\n      const user = await userModal.findOne({ username })\r\n      if (!user) return res.status(404).json({ error: 'User not found' })\r\n\r\n      // Basic IP + device detection (for optional sender hints)\r\n      const xff = req.headers['x-forwarded-for']\r\n      const ip = Array.isArray(xff)\r\n        ? xff[0]\r\n        : (typeof xff === 'string' ? xff.split(',')[0].trim() : req.socket?.remoteAddress || null)\r\n\r\n      const ua = req.headers['user-agent'] || ''\r\n      let deviceType = 'Unknown'\r\n      if (/mobile|iphone|android/i.test(ua)) {\r\n        deviceType = 'Mobile'\r\n      } else if (/ipad|tablet/i.test(ua)) {\r\n        deviceType = 'Tablet'\r\n      } else if (ua) {\r\n        deviceType = 'Desktop'\r\n      }\r\n\r\n      let os = null\r\n      if (/Windows/i.test(ua)) os = 'Windows'\r\n      else if (/Mac OS X/i.test(ua)) os = 'macOS'\r\n      else if (/Android/i.test(ua)) os = 'Android'\r\n      else if (/iPhone|iPad|iPod/i.test(ua)) os = 'iOS'\r\n      else if (/Linux/i.test(ua)) os = 'Linux'\r\n\r\n      const senderMeta = {\r\n        share: !!shareMeta\r\n      }\r\n\r\n      if (shareMeta) {\r\n        senderMeta.ip = ip || null\r\n        senderMeta.deviceType = deviceType\r\n        senderMeta.os = os\r\n        senderMeta.userAgent = ua || null\r\n      }\r\n\r\n      await messageModal.create({ message, mood, userId: user._id, senderMeta })\r\n      return res.status(200).json({ msg: message })\r\n    } catch (e) {\r\n      console.error(e)\r\n      return res.status(500).json({ error: e.message })\r\n    }\r\n  }\r\n  return res.status(405).end()\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE;AAElB,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,EAAE,MAAM,EAAE,GAAG;IACnB,MAAM,WAAW,IAAI,KAAK,CAAC,QAAQ;IACnC,IAAI,WAAW,QAAQ;QACrB,IAAI;YACF,MAAM,EAAE,OAAO,EAAE,OAAO,SAAS,EAAE,YAAY,KAAK,EAAE,GAAG,IAAI,IAAI;YACjE,IAAI,CAAC,SAAS,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAmB;YACtE,MAAM,OAAO,MAAM,UAAU,OAAO,CAAC;gBAAE;YAAS;YAChD,IAAI,CAAC,MAAM,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAiB;YAEjE,0DAA0D;YAC1D,MAAM,MAAM,IAAI,OAAO,CAAC,kBAAkB;YAC1C,MAAM,KAAK,MAAM,OAAO,CAAC,OACrB,GAAG,CAAC,EAAE,GACL,OAAO,QAAQ,WAAW,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,KAAK,IAAI,MAAM,EAAE,iBAAiB;YAEvF,MAAM,KAAK,IAAI,OAAO,CAAC,aAAa,IAAI;YACxC,IAAI,aAAa;YACjB,IAAI,yBAAyB,IAAI,CAAC,KAAK;gBACrC,aAAa;YACf,OAAO,IAAI,eAAe,IAAI,CAAC,KAAK;gBAClC,aAAa;YACf,OAAO,IAAI,IAAI;gBACb,aAAa;YACf;YAEA,IAAI,KAAK;YACT,IAAI,WAAW,IAAI,CAAC,KAAK,KAAK;iBACzB,IAAI,YAAY,IAAI,CAAC,KAAK,KAAK;iBAC/B,IAAI,WAAW,IAAI,CAAC,KAAK,KAAK;iBAC9B,IAAI,oBAAoB,IAAI,CAAC,KAAK,KAAK;iBACvC,IAAI,SAAS,IAAI,CAAC,KAAK,KAAK;YAEjC,MAAM,aAAa;gBACjB,OAAO,CAAC,CAAC;YACX;YAEA,IAAI,WAAW;gBACb,WAAW,EAAE,GAAG,MAAM;gBACtB,WAAW,UAAU,GAAG;gBACxB,WAAW,EAAE,GAAG;gBAChB,WAAW,SAAS,GAAG,MAAM;YAC/B;YAEA,MAAM,aAAa,MAAM,CAAC;gBAAE;gBAAS;gBAAM,QAAQ,KAAK,GAAG;gBAAE;YAAW;YACxE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,KAAK;YAAQ;QAC7C,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC;YACd,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO,EAAE,OAAO;YAAC;QACjD;IACF;IACA,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;AAC5B"}}]
}