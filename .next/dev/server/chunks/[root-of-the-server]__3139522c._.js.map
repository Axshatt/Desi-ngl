{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/db.js"],"sourcesContent":["const mongoose = require(\"mongoose\");\r\nrequire('dotenv').config()\r\n\r\nconst Schema = mongoose.Schema;\r\nconst ObjectId = Schema.ObjectId;\r\n\r\nif (mongoose.connection.readyState === 0) {\r\n    if (process.env.DATABASE) {\r\n        mongoose.connect(process.env.DATABASE)\r\n            .then(() => console.log(\"Connected to DB\"))\r\n            .catch(err => console.error(\"DB Config Error:\", err));\r\n    } else {\r\n        console.warn(\"No DATABASE environment variable found.\");\r\n    }\r\n}\r\n\r\nconst userSchema = new Schema({\r\n    username: { type: String, unique: true },\r\n    email: String,\r\n    isPremium: { type: Boolean, default: false },\r\n    stripeCustomerId: String,\r\n    createdAt: { type: Date, default: Date.now }\r\n})\r\n\r\nconst messageSchema = new Schema({\r\n    message: String,\r\n    mood: { type: String, default: 'Serious' },\r\n    userId: ObjectId,\r\n    reply: { type: String, default: null },\r\n    senderConsent: {\r\n        type: String,\r\n        enum: ['pending', 'revealed', 'declined'],\r\n        default: 'pending'\r\n    },\r\n    senderHint: String, // e.g. \"iPhone user in Mumbai\"\r\n    createdAt: { type: Date, default: Date.now }\r\n})\r\n\r\n// Prevent model overwrite error in dev mode\r\nif (mongoose.models.users) delete mongoose.models.users\r\nif (mongoose.models.messages) delete mongoose.models.messages\r\n\r\nconst userModal = mongoose.model(\"users\", userSchema);\r\nconst messageModal = mongoose.model(\"messages\", messageSchema);\r\n\r\nmodule.exports = {\r\n    userModal,\r\n    messageModal\r\n}\r\n"],"names":[],"mappings":"AAAA,MAAM;AACN,+GAAkB,MAAM;AAExB,MAAM,SAAS,SAAS,MAAM;AAC9B,MAAM,WAAW,OAAO,QAAQ;AAEhC,IAAI,SAAS,UAAU,CAAC,UAAU,KAAK,GAAG;IACtC,IAAI,QAAQ,GAAG,CAAC,QAAQ,EAAE;QACtB,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC,QAAQ,EAChC,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC,oBACvB,KAAK,CAAC,CAAA,MAAO,QAAQ,KAAK,CAAC,oBAAoB;IACxD,OAAO;QACH,QAAQ,IAAI,CAAC;IACjB;AACJ;AAEA,MAAM,aAAa,IAAI,OAAO;IAC1B,UAAU;QAAE,MAAM;QAAQ,QAAQ;IAAK;IACvC,OAAO;IACP,WAAW;QAAE,MAAM;QAAS,SAAS;IAAM;IAC3C,kBAAkB;IAClB,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AAEA,MAAM,gBAAgB,IAAI,OAAO;IAC7B,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,SAAS;IAAU;IACzC,QAAQ;IACR,OAAO;QAAE,MAAM;QAAQ,SAAS;IAAK;IACrC,eAAe;QACX,MAAM;QACN,MAAM;YAAC;YAAW;YAAY;SAAW;QACzC,SAAS;IACb;IACA,YAAY;IACZ,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AAEA,4CAA4C;AAC5C,IAAI,SAAS,MAAM,CAAC,KAAK,EAAE,OAAO,SAAS,MAAM,CAAC,KAAK;AACvD,IAAI,SAAS,MAAM,CAAC,QAAQ,EAAE,OAAO,SAAS,MAAM,CAAC,QAAQ;AAE7D,MAAM,YAAY,SAAS,KAAK,CAAC,SAAS;AAC1C,MAAM,eAAe,SAAS,KAAK,CAAC,YAAY;AAEhD,OAAO,OAAO,GAAG;IACb;IACA;AACJ"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/pages/api/admin/reply.js"],"sourcesContent":["const { messageModal, userModal } = require('../../../db')\r\nconst jwt = require('jsonwebtoken')\r\n\r\nexport default async function handler(req, res) {\r\n    if (req.method !== 'POST') return res.status(405).end()\r\n\r\n    try {\r\n        const { token, messageId, replyText } = req.body\r\n        if (!token || !messageId || !replyText) return res.status(400).json({ error: 'Missing fields' })\r\n\r\n        const decoded = jwt.verify(token, process.env.JWT_PASS)\r\n        const user = await userModal.findOne({ username: decoded.username })\r\n        if (!user) return res.status(404).json({ error: 'User not found' })\r\n\r\n        const message = await messageModal.findOne({ _id: messageId, userId: user._id })\r\n        if (!message) return res.status(404).json({ error: 'Message not found' })\r\n\r\n        message.reply = replyText\r\n        await message.save()\r\n\r\n        return res.status(200).json({ success: true, message: 'Reply sent!' })\r\n    } catch (e) {\r\n        console.error(e)\r\n        return res.status(500).json({ error: e.message })\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE;AACjC,MAAM;AAES,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC1C,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;IAErD,IAAI;QACA,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,IAAI,IAAI;QAChD,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,WAAW,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAiB;QAE9F,MAAM,UAAU,IAAI,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,QAAQ;QACtD,MAAM,OAAO,MAAM,UAAU,OAAO,CAAC;YAAE,UAAU,QAAQ,QAAQ;QAAC;QAClE,IAAI,CAAC,MAAM,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAiB;QAEjE,MAAM,UAAU,MAAM,aAAa,OAAO,CAAC;YAAE,KAAK;YAAW,QAAQ,KAAK,GAAG;QAAC;QAC9E,IAAI,CAAC,SAAS,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAoB;QAEvE,QAAQ,KAAK,GAAG;QAChB,MAAM,QAAQ,IAAI;QAElB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAc;IACxE,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC;QACd,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC;IACnD;AACJ"}}]
}