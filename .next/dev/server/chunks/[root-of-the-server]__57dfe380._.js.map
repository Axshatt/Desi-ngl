{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/db.js"],"sourcesContent":["const mongoose = require(\"mongoose\");\r\nrequire('dotenv').config()\r\n\r\nconst Schema = mongoose.Schema;\r\nconst ObjectId = Schema.ObjectId;\r\n\r\nif (mongoose.connection.readyState === 0) {\r\n    if (process.env.DATABASE) {\r\n        mongoose.connect(process.env.DATABASE)\r\n            .then(() => console.log(\"Connected to DB\"))\r\n            .catch(err => console.error(\"DB Config Error:\", err));\r\n    } else {\r\n        console.warn(\"No DATABASE environment variable found.\");\r\n    }\r\n}\r\n\r\nconst userSchema = new Schema({\r\n    username: String,\r\n})\r\nconst messageSchema = new Schema({\r\n    message: String,\r\n    userId: ObjectId\r\n})\r\n\r\nconst subscriptionSchema = new Schema({\r\n    username: String,\r\n    endpoint: String,\r\n    keys: {\r\n        p256dh: String,\r\n        auth: String\r\n    }\r\n})\r\n\r\n// Prevent model overwrite error in dev mode\r\nconst userModal = mongoose.models.users || mongoose.model(\"users\", userSchema);\r\nconst messageModal = mongoose.models.messages || mongoose.model(\"messages\", messageSchema);\r\nconst subscriptionModal = mongoose.models.subscriptions || mongoose.model(\"subscriptions\", subscriptionSchema);\r\n\r\nmodule.exports = {\r\n    userModal,\r\n    messageModal,\r\n    subscriptionModal\r\n}\r\n"],"names":[],"mappings":"AAAA,MAAM;AACN,+GAAkB,MAAM;AAExB,MAAM,SAAS,SAAS,MAAM;AAC9B,MAAM,WAAW,OAAO,QAAQ;AAEhC,IAAI,SAAS,UAAU,CAAC,UAAU,KAAK,GAAG;IACtC,IAAI,QAAQ,GAAG,CAAC,QAAQ,EAAE;QACtB,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC,QAAQ,EAChC,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC,oBACvB,KAAK,CAAC,CAAA,MAAO,QAAQ,KAAK,CAAC,oBAAoB;IACxD,OAAO;QACH,QAAQ,IAAI,CAAC;IACjB;AACJ;AAEA,MAAM,aAAa,IAAI,OAAO;IAC1B,UAAU;AACd;AACA,MAAM,gBAAgB,IAAI,OAAO;IAC7B,SAAS;IACT,QAAQ;AACZ;AAEA,MAAM,qBAAqB,IAAI,OAAO;IAClC,UAAU;IACV,UAAU;IACV,MAAM;QACF,QAAQ;QACR,MAAM;IACV;AACJ;AAEA,4CAA4C;AAC5C,MAAM,YAAY,SAAS,MAAM,CAAC,KAAK,IAAI,SAAS,KAAK,CAAC,SAAS;AACnE,MAAM,eAAe,SAAS,MAAM,CAAC,QAAQ,IAAI,SAAS,KAAK,CAAC,YAAY;AAC5E,MAAM,oBAAoB,SAAS,MAAM,CAAC,aAAa,IAAI,SAAS,KAAK,CAAC,iBAAiB;AAE3F,OAAO,OAAO,GAAG;IACb;IACA;IACA;AACJ"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/pages/api/subscribe.js"],"sourcesContent":["const { subscriptionModal } = require('../../db')\r\n\r\nexport default async function handler(req, res) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    const { subscription, username } = req.body;\r\n\r\n    if (!subscription || !username) {\r\n        return res.status(400).json({ error: 'Missing subscription or username' });\r\n    }\r\n\r\n    try {\r\n        await subscriptionModal.findOneAndUpdate(\r\n            { username, endpoint: subscription.endpoint }, // Prevent duplicates for same device\r\n            {\r\n                username,\r\n                endpoint: subscription.endpoint,\r\n                keys: subscription.keys\r\n            },\r\n            { upsert: true, new: true }\r\n        );\r\n        res.status(200).json({ message: 'Subscribed successfully' });\r\n    } catch (error) {\r\n        console.error('Subscription error:', error);\r\n        res.status(500).json({ error: 'Failed to subscribe' });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,MAAM,EAAE,iBAAiB,EAAE;AAEZ,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC1C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACvB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC9D;IAEA,MAAM,EAAE,YAAY,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IAE3C,IAAI,CAAC,gBAAgB,CAAC,UAAU;QAC5B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAmC;IAC5E;IAEA,IAAI;QACA,MAAM,kBAAkB,gBAAgB,CACpC;YAAE;YAAU,UAAU,aAAa,QAAQ;QAAC,GAC5C;YACI;YACA,UAAU,aAAa,QAAQ;YAC/B,MAAM,aAAa,IAAI;QAC3B,GACA;YAAE,QAAQ;YAAM,KAAK;QAAK;QAE9B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAA0B;IAC9D,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uBAAuB;QACrC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAsB;IACxD;AACJ"}}]
}