{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/db.js"],"sourcesContent":["const mongoose = require(\"mongoose\");\nrequire('dotenv').config()\n\nconst Schema = mongoose.Schema;\nconst ObjectId = Schema.ObjectId;\n\nif (mongoose.connection.readyState === 0) {\n    if (process.env.DATABASE) {\n        mongoose.connect(process.env.DATABASE)\n            .then(() => console.log(\"Connected to DB\"))\n            .catch(err => console.error(\"DB Config Error:\", err));\n    } else {\n        console.warn(\"No DATABASE environment variable found.\");\n    }\n}\n\nconst userSchema = new Schema({\n    username: String,\n    createdAt: { type: Date, default: Date.now }\n})\nconst replySchema = new Schema({\n    reply: String,\n    repliedBy: String, // username of the person replying\n    repliedAt: { type: Date, default: Date.now }\n})\n\nconst messageSchema = new Schema({\n    message: String,\n    mood: { type: String, default: 'Serious' },\n    userId: ObjectId,\n    // Unique token for sender to view their message and replies\n    senderToken: { type: String, unique: true, sparse: true },\n    // Dynamic reactions - can accept any emoji as key\n    reactions: { type: Schema.Types.Mixed, default: {} },\n    // Replies from the message receiver\n    replies: [replySchema],\n    // Optional sender metadata if they choose to share hints\n    senderMeta: {\n        share: { type: Boolean, default: false },\n        ip: { type: String, default: null },\n        deviceType: { type: String, default: null },\n        os: { type: String, default: null },\n        userAgent: { type: String, default: null }\n    },\n    createdAt: { type: Date, default: Date.now }\n})\n\n// Prevent model overwrite error in dev mode\nif (mongoose.models.users) delete mongoose.models.users\nif (mongoose.models.messages) delete mongoose.models.messages\n\nconst userModal = mongoose.model(\"users\", userSchema);\nconst messageModal = mongoose.model(\"messages\", messageSchema);\n\nmodule.exports = {\n    userModal,\n    messageModal\n}\n"],"names":[],"mappings":"AAAA,MAAM;AACN,+GAAkB,MAAM;AAExB,MAAM,SAAS,SAAS,MAAM;AAC9B,MAAM,WAAW,OAAO,QAAQ;AAEhC,IAAI,SAAS,UAAU,CAAC,UAAU,KAAK,GAAG;IACtC,IAAI,QAAQ,GAAG,CAAC,QAAQ,EAAE;QACtB,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC,QAAQ,EAChC,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC,oBACvB,KAAK,CAAC,CAAA,MAAO,QAAQ,KAAK,CAAC,oBAAoB;IACxD,OAAO;QACH,QAAQ,IAAI,CAAC;IACjB;AACJ;AAEA,MAAM,aAAa,IAAI,OAAO;IAC1B,UAAU;IACV,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AACA,MAAM,cAAc,IAAI,OAAO;IAC3B,OAAO;IACP,WAAW;IACX,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AAEA,MAAM,gBAAgB,IAAI,OAAO;IAC7B,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,SAAS;IAAU;IACzC,QAAQ;IACR,4DAA4D;IAC5D,aAAa;QAAE,MAAM;QAAQ,QAAQ;QAAM,QAAQ;IAAK;IACxD,kDAAkD;IAClD,WAAW;QAAE,MAAM,OAAO,KAAK,CAAC,KAAK;QAAE,SAAS,CAAC;IAAE;IACnD,oCAAoC;IACpC,SAAS;QAAC;KAAY;IACtB,yDAAyD;IACzD,YAAY;QACR,OAAO;YAAE,MAAM;YAAS,SAAS;QAAM;QACvC,IAAI;YAAE,MAAM;YAAQ,SAAS;QAAK;QAClC,YAAY;YAAE,MAAM;YAAQ,SAAS;QAAK;QAC1C,IAAI;YAAE,MAAM;YAAQ,SAAS;QAAK;QAClC,WAAW;YAAE,MAAM;YAAQ,SAAS;QAAK;IAC7C;IACA,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AAEA,4CAA4C;AAC5C,IAAI,SAAS,MAAM,CAAC,KAAK,EAAE,OAAO,SAAS,MAAM,CAAC,KAAK;AACvD,IAAI,SAAS,MAAM,CAAC,QAAQ,EAAE,OAAO,SAAS,MAAM,CAAC,QAAQ;AAE7D,MAAM,YAAY,SAAS,KAAK,CAAC,SAAS;AAC1C,MAAM,eAAe,SAAS,KAAK,CAAC,YAAY;AAEhD,OAAO,OAAO,GAAG;IACb;IACA;AACJ"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/pages/api/admin/users.js"],"sourcesContent":["import { userModal, messageModal } from '../../../db'\r\n\r\nexport default async function handler(req, res) {\r\n  // Simple auth check\r\n  const authHeader = req.headers.authorization\r\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n    return res.status(401).json({ error: 'Unauthorized' })\r\n  }\r\n\r\n  if (req.method === 'GET') {\r\n    try {\r\n      const { page = 1, limit = 50, search = '' } = req.query\r\n      const skip = (parseInt(page) - 1) * parseInt(limit)\r\n\r\n      let query = {}\r\n      if (search) {\r\n        query.username = { $regex: search, $options: 'i' }\r\n      }\r\n\r\n      const users = await userModal.find(query)\r\n        .select('username createdAt')\r\n        .sort({ createdAt: -1 })\r\n        .skip(skip)\r\n        .limit(parseInt(limit))\r\n        .lean()\r\n\r\n      // Get message counts for each user\r\n      const usersWithStats = await Promise.all(\r\n        users.map(async (user) => {\r\n          const messageCount = await messageModal.countDocuments({ userId: user._id })\r\n          return {\r\n            ...user,\r\n            messageCount\r\n          }\r\n        })\r\n      )\r\n\r\n      const totalUsers = await userModal.countDocuments(query)\r\n\r\n      return res.status(200).json({\r\n        success: true,\r\n        users: usersWithStats,\r\n        pagination: {\r\n          page: parseInt(page),\r\n          limit: parseInt(limit),\r\n          total: totalUsers,\r\n          pages: Math.ceil(totalUsers / parseInt(limit))\r\n        }\r\n      })\r\n    } catch (error) {\r\n      console.error('Get users error:', error)\r\n      return res.status(500).json({ error: 'Failed to fetch users' })\r\n    }\r\n  }\r\n\r\n  if (req.method === 'DELETE') {\r\n    try {\r\n      const { userId } = req.body\r\n      if (!userId) {\r\n        return res.status(400).json({ error: 'User ID required' })\r\n      }\r\n\r\n      // Delete user and all their messages\r\n      await messageModal.deleteMany({ userId })\r\n      await userModal.findByIdAndDelete(userId)\r\n\r\n      return res.status(200).json({ success: true, message: 'User deleted successfully' })\r\n    } catch (error) {\r\n      console.error('Delete user error:', error)\r\n      return res.status(500).json({ error: 'Failed to delete user' })\r\n    }\r\n  }\r\n\r\n  return res.status(405).json({ error: 'Method not allowed' })\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,oBAAoB;IACpB,MAAM,aAAa,IAAI,OAAO,CAAC,aAAa;IAC5C,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,YAAY;QACpD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAe;IACtD;IAEA,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,IAAI;YACF,MAAM,EAAE,OAAO,CAAC,EAAE,QAAQ,EAAE,EAAE,SAAS,EAAE,EAAE,GAAG,IAAI,KAAK;YACvD,MAAM,OAAO,CAAC,SAAS,QAAQ,CAAC,IAAI,SAAS;YAE7C,IAAI,QAAQ,CAAC;YACb,IAAI,QAAQ;gBACV,MAAM,QAAQ,GAAG;oBAAE,QAAQ;oBAAQ,UAAU;gBAAI;YACnD;YAEA,MAAM,QAAQ,MAAM,uHAAS,CAAC,IAAI,CAAC,OAChC,MAAM,CAAC,sBACP,IAAI,CAAC;gBAAE,WAAW,CAAC;YAAE,GACrB,IAAI,CAAC,MACL,KAAK,CAAC,SAAS,QACf,IAAI;YAEP,mCAAmC;YACnC,MAAM,iBAAiB,MAAM,QAAQ,GAAG,CACtC,MAAM,GAAG,CAAC,OAAO;gBACf,MAAM,eAAe,MAAM,0HAAY,CAAC,cAAc,CAAC;oBAAE,QAAQ,KAAK,GAAG;gBAAC;gBAC1E,OAAO;oBACL,GAAG,IAAI;oBACP;gBACF;YACF;YAGF,MAAM,aAAa,MAAM,uHAAS,CAAC,cAAc,CAAC;YAElD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAC1B,SAAS;gBACT,OAAO;gBACP,YAAY;oBACV,MAAM,SAAS;oBACf,OAAO,SAAS;oBAChB,OAAO;oBACP,OAAO,KAAK,IAAI,CAAC,aAAa,SAAS;gBACzC;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,oBAAoB;YAClC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAwB;QAC/D;IACF;IAEA,IAAI,IAAI,MAAM,KAAK,UAAU;QAC3B,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,IAAI;YAC3B,IAAI,CAAC,QAAQ;gBACX,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,OAAO;gBAAmB;YAC1D;YAEA,qCAAqC;YACrC,MAAM,0HAAY,CAAC,UAAU,CAAC;gBAAE;YAAO;YACvC,MAAM,uHAAS,CAAC,iBAAiB,CAAC;YAElC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;gBAAM,SAAS;YAA4B;QACpF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sBAAsB;YACpC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAwB;QAC/D;IACF;IAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;AAC5D"}}]
}