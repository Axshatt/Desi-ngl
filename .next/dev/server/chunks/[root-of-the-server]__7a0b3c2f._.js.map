{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/db.js"],"sourcesContent":["const mongoose = require(\"mongoose\");\nrequire('dotenv').config()\n\nconst Schema = mongoose.Schema;\nconst ObjectId = Schema.ObjectId;\n\nif (mongoose.connection.readyState === 0) {\n    if (process.env.DATABASE) {\n        mongoose.connect(process.env.DATABASE)\n            .then(() => console.log(\"Connected to DB\"))\n            .catch(err => console.error(\"DB Config Error:\", err));\n    } else {\n        console.warn(\"No DATABASE environment variable found.\");\n    }\n}\n\nconst userSchema = new Schema({\n    username: String,\n    createdAt: { type: Date, default: Date.now }\n})\nconst replySchema = new Schema({\n    reply: String,\n    repliedBy: String, // username of the person replying\n    repliedAt: { type: Date, default: Date.now }\n})\n\nconst messageSchema = new Schema({\n    message: String,\n    mood: { type: String, default: 'Serious' },\n    userId: ObjectId,\n    // Unique token for sender to view their message and replies\n    senderToken: { type: String, unique: true, sparse: true },\n    // Dynamic reactions - can accept any emoji as key\n    reactions: { type: Schema.Types.Mixed, default: {} },\n    // Replies from the message receiver\n    replies: [replySchema],\n    // Optional sender metadata if they choose to share hints\n    senderMeta: {\n        share: { type: Boolean, default: false },\n        ip: { type: String, default: null },\n        deviceType: { type: String, default: null },\n        os: { type: String, default: null },\n        userAgent: { type: String, default: null }\n    },\n    createdAt: { type: Date, default: Date.now }\n})\n\n// Prevent model overwrite error in dev mode\nif (mongoose.models.users) delete mongoose.models.users\nif (mongoose.models.messages) delete mongoose.models.messages\n\nconst userModal = mongoose.model(\"users\", userSchema);\nconst messageModal = mongoose.model(\"messages\", messageSchema);\n\nmodule.exports = {\n    userModal,\n    messageModal\n}\n"],"names":[],"mappings":"AAAA,MAAM;AACN,+GAAkB,MAAM;AAExB,MAAM,SAAS,SAAS,MAAM;AAC9B,MAAM,WAAW,OAAO,QAAQ;AAEhC,IAAI,SAAS,UAAU,CAAC,UAAU,KAAK,GAAG;IACtC,IAAI,QAAQ,GAAG,CAAC,QAAQ,EAAE;QACtB,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC,QAAQ,EAChC,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC,oBACvB,KAAK,CAAC,CAAA,MAAO,QAAQ,KAAK,CAAC,oBAAoB;IACxD,OAAO;QACH,QAAQ,IAAI,CAAC;IACjB;AACJ;AAEA,MAAM,aAAa,IAAI,OAAO;IAC1B,UAAU;IACV,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AACA,MAAM,cAAc,IAAI,OAAO;IAC3B,OAAO;IACP,WAAW;IACX,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AAEA,MAAM,gBAAgB,IAAI,OAAO;IAC7B,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,SAAS;IAAU;IACzC,QAAQ;IACR,4DAA4D;IAC5D,aAAa;QAAE,MAAM;QAAQ,QAAQ;QAAM,QAAQ;IAAK;IACxD,kDAAkD;IAClD,WAAW;QAAE,MAAM,OAAO,KAAK,CAAC,KAAK;QAAE,SAAS,CAAC;IAAE;IACnD,oCAAoC;IACpC,SAAS;QAAC;KAAY;IACtB,yDAAyD;IACzD,YAAY;QACR,OAAO;YAAE,MAAM;YAAS,SAAS;QAAM;QACvC,IAAI;YAAE,MAAM;YAAQ,SAAS;QAAK;QAClC,YAAY;YAAE,MAAM;YAAQ,SAAS;QAAK;QAC1C,IAAI;YAAE,MAAM;YAAQ,SAAS;QAAK;QAClC,WAAW;YAAE,MAAM;YAAQ,SAAS;QAAK;IAC7C;IACA,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C;AAEA,4CAA4C;AAC5C,IAAI,SAAS,MAAM,CAAC,KAAK,EAAE,OAAO,SAAS,MAAM,CAAC,KAAK;AACvD,IAAI,SAAS,MAAM,CAAC,QAAQ,EAAE,OAAO,SAAS,MAAM,CAAC,QAAQ;AAE7D,MAAM,YAAY,SAAS,KAAK,CAAC,SAAS;AAC1C,MAAM,eAAe,SAAS,KAAK,CAAC,YAAY;AAEhD,OAAO,OAAO,GAAG;IACb;IACA;AACJ"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/pages/api/message/reaction.js"],"sourcesContent":["import { messageModal } from '../../../db'\n\nexport default async function handler(req, res) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  const { messageId, reaction, username } = req.body\n\n  if (!messageId || !reaction || !username) {\n    return res.status(400).json({ error: 'Message ID, reaction, and username required' })\n  }\n\n  // Validate that reaction is a reasonable emoji (not empty, reasonable length)\n  // Emojis can be 1-4 characters due to modifiers, skin tones, etc.\n  if (!reaction || typeof reaction !== 'string' || reaction.trim().length === 0) {\n    return res.status(400).json({ error: 'Reaction must be a valid emoji' })\n  }\n  \n  // Basic validation: emoji should be reasonable length (most are 1-4 chars)\n  // Some complex emojis with modifiers can be longer, so we allow up to 10 chars\n  if (reaction.length > 10) {\n    return res.status(400).json({ error: 'Invalid reaction - emoji too long' })\n  }\n\n  try {\n    const message = await messageModal.findById(messageId)\n\n    if (!message) {\n      return res.status(404).json({ error: 'Message not found' })\n    }\n\n    // Ensure reactions object exists\n    if (!message.reactions || typeof message.reactions !== 'object') {\n      message.reactions = {}\n    }\n    \n    // Initialize reaction array if it doesn't exist\n    if (!Array.isArray(message.reactions[reaction])) {\n      message.reactions[reaction] = []\n    }\n\n    // Check if user already reacted\n    const reactedIndex = message.reactions[reaction].indexOf(username)\n\n    if (reactedIndex !== -1) {\n      // User already reacted, remove reaction (toggle off)\n      message.reactions[reaction].splice(reactedIndex, 1)\n    } else {\n      // User hasn't reacted, add reaction\n      message.reactions[reaction].push(username)\n    }\n\n    // Mark the reactions field as modified (required for Mixed type in Mongoose)\n    message.markModified('reactions')\n    await message.save()\n\n    return res.status(200).json({ \n      success: true, \n      reactions: message.reactions,\n      userReacted: reactedIndex === -1 // true if just added, false if removed\n    })\n  } catch (error) {\n    console.error('Reaction error:', error)\n    return res.status(500).json({ error: 'Failed to save reaction' })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IAElD,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,UAAU;QACxC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA8C;IACrF;IAEA,8EAA8E;IAC9E,kEAAkE;IAClE,IAAI,CAAC,YAAY,OAAO,aAAa,YAAY,SAAS,IAAI,GAAG,MAAM,KAAK,GAAG;QAC7E,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAiC;IACxE;IAEA,2EAA2E;IAC3E,+EAA+E;IAC/E,IAAI,SAAS,MAAM,GAAG,IAAI;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAoC;IAC3E;IAEA,IAAI;QACF,MAAM,UAAU,MAAM,0HAAY,CAAC,QAAQ,CAAC;QAE5C,IAAI,CAAC,SAAS;YACZ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAoB;QAC3D;QAEA,iCAAiC;QACjC,IAAI,CAAC,QAAQ,SAAS,IAAI,OAAO,QAAQ,SAAS,KAAK,UAAU;YAC/D,QAAQ,SAAS,GAAG,CAAC;QACvB;QAEA,gDAAgD;QAChD,IAAI,CAAC,MAAM,OAAO,CAAC,QAAQ,SAAS,CAAC,SAAS,GAAG;YAC/C,QAAQ,SAAS,CAAC,SAAS,GAAG,EAAE;QAClC;QAEA,gCAAgC;QAChC,MAAM,eAAe,QAAQ,SAAS,CAAC,SAAS,CAAC,OAAO,CAAC;QAEzD,IAAI,iBAAiB,CAAC,GAAG;YACvB,qDAAqD;YACrD,QAAQ,SAAS,CAAC,SAAS,CAAC,MAAM,CAAC,cAAc;QACnD,OAAO;YACL,oCAAoC;YACpC,QAAQ,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC;QACnC;QAEA,6EAA6E;QAC7E,QAAQ,YAAY,CAAC;QACrB,MAAM,QAAQ,IAAI;QAElB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAC1B,SAAS;YACT,WAAW,QAAQ,SAAS;YAC5B,aAAa,iBAAiB,CAAC,EAAE,uCAAuC;QAC1E;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA0B;IACjE;AACF"}}]
}