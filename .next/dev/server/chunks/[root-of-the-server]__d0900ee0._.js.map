{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/db.js"],"sourcesContent":["const mongoose = require(\"mongoose\");\r\nrequire('dotenv').config()\r\n\r\nconst Schema = mongoose.Schema;\r\nconst ObjectId = Schema.ObjectId;\r\n\r\nif (mongoose.connection.readyState === 0) {\r\n    if (process.env.DATABASE) {\r\n        mongoose.connect(process.env.DATABASE)\r\n            .then(() => console.log(\"Connected to DB\"))\r\n            .catch(err => console.error(\"DB Config Error:\", err));\r\n    } else {\r\n        console.warn(\"No DATABASE environment variable found.\");\r\n    }\r\n}\r\n\r\nconst userSchema = new Schema({\r\n    username: String,\r\n    stripeCustomerId: { type: String, default: null },\r\n    subscriptionStatus: { type: String, default: 'free' }, // 'free', 'active', 'canceled', 'past_due'\r\n    subscriptionId: { type: String, default: null },\r\n    subscriptionEndDate: { type: Date, default: null }\r\n})\r\nconst messageSchema = new Schema({\r\n    message: String,\r\n    mood: { type: String, default: 'Serious' },\r\n    userId: ObjectId\r\n})\r\n\r\n// Prevent model overwrite error in dev mode\r\nif (mongoose.models.users) delete mongoose.models.users\r\nif (mongoose.models.messages) delete mongoose.models.messages\r\n\r\nconst userModal = mongoose.model(\"users\", userSchema);\r\nconst messageModal = mongoose.model(\"messages\", messageSchema);\r\n\r\nmodule.exports = {\r\n    userModal,\r\n    messageModal\r\n}\r\n"],"names":[],"mappings":"AAAA,MAAM;AACN,+GAAkB,MAAM;AAExB,MAAM,SAAS,SAAS,MAAM;AAC9B,MAAM,WAAW,OAAO,QAAQ;AAEhC,IAAI,SAAS,UAAU,CAAC,UAAU,KAAK,GAAG;IACtC,IAAI,QAAQ,GAAG,CAAC,QAAQ,EAAE;QACtB,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC,QAAQ,EAChC,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC,oBACvB,KAAK,CAAC,CAAA,MAAO,QAAQ,KAAK,CAAC,oBAAoB;IACxD,OAAO;QACH,QAAQ,IAAI,CAAC;IACjB;AACJ;AAEA,MAAM,aAAa,IAAI,OAAO;IAC1B,UAAU;IACV,kBAAkB;QAAE,MAAM;QAAQ,SAAS;IAAK;IAChD,oBAAoB;QAAE,MAAM;QAAQ,SAAS;IAAO;IACpD,gBAAgB;QAAE,MAAM;QAAQ,SAAS;IAAK;IAC9C,qBAAqB;QAAE,MAAM;QAAM,SAAS;IAAK;AACrD;AACA,MAAM,gBAAgB,IAAI,OAAO;IAC7B,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,SAAS;IAAU;IACzC,QAAQ;AACZ;AAEA,4CAA4C;AAC5C,IAAI,SAAS,MAAM,CAAC,KAAK,EAAE,OAAO,SAAS,MAAM,CAAC,KAAK;AACvD,IAAI,SAAS,MAAM,CAAC,QAAQ,EAAE,OAAO,SAAS,MAAM,CAAC,QAAQ;AAE7D,MAAM,YAAY,SAAS,KAAK,CAAC,SAAS;AAC1C,MAAM,eAAe,SAAS,KAAK,CAAC,YAAY;AAEhD,OAAO,OAAO,GAAG;IACb;IACA;AACJ"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///D:/Akshat%20Singh/SideProjIdeas/Desi-Ngl/pages/api/stripe/create-checkout-session.js"],"sourcesContent":["const Stripe = require('stripe')\r\nconst { userModal } = require('../../../db')\r\n\r\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY)\r\n\r\nexport default async function handler(req, res) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' })\r\n    }\r\n\r\n    try {\r\n        const { username } = req.body\r\n\r\n        if (!username) {\r\n            return res.status(400).json({ error: 'Username is required' })\r\n        }\r\n\r\n        // Find user\r\n        let user = await userModal.findOne({ username })\r\n        if (!user) {\r\n            return res.status(404).json({ error: 'User not found' })\r\n        }\r\n\r\n        // Create or retrieve Stripe customer\r\n        let customerId = user.stripeCustomerId\r\n        if (!customerId) {\r\n            const customer = await stripe.customers.create({\r\n                metadata: { username }\r\n            })\r\n            customerId = customer.id\r\n            user.stripeCustomerId = customerId\r\n            await user.save()\r\n        }\r\n\r\n        // Create checkout session\r\n        const session = await stripe.checkout.sessions.create({\r\n            customer: customerId,\r\n            payment_method_types: ['card'],\r\n            line_items: [{\r\n                price_data: {\r\n                    currency: 'inr',\r\n                    product_data: {\r\n                        name: 'DesiNGL Pro',\r\n                        description: 'Premium features including sender hints and priority support'\r\n                    },\r\n                    unit_amount: 9900, // â‚¹99 in paise\r\n                    recurring: { interval: 'month' }\r\n                },\r\n                quantity: 1\r\n            }],\r\n            mode: 'subscription',\r\n            success_url: `${process.env.NEXT_PUBLIC_APP_URL}/premium/success?session_id={CHECKOUT_SESSION_ID}`,\r\n            cancel_url: `${process.env.NEXT_PUBLIC_APP_URL}/premium?canceled=true`,\r\n            metadata: { username }\r\n        })\r\n\r\n        res.status(200).json({ sessionId: session.id })\r\n    } catch (error) {\r\n        console.error('Stripe checkout error:', error)\r\n        res.status(500).json({ error: error.message })\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,MAAM;AACN,MAAM,EAAE,SAAS,EAAE;AAEnB,MAAM,SAAS,IAAI,OAAO,QAAQ,GAAG,CAAC,iBAAiB;AAExC,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC1C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACvB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC9D;IAEA,IAAI;QACA,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;QAE7B,IAAI,CAAC,UAAU;YACX,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAuB;QAChE;QAEA,YAAY;QACZ,IAAI,OAAO,MAAM,UAAU,OAAO,CAAC;YAAE;QAAS;QAC9C,IAAI,CAAC,MAAM;YACP,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAiB;QAC1D;QAEA,qCAAqC;QACrC,IAAI,aAAa,KAAK,gBAAgB;QACtC,IAAI,CAAC,YAAY;YACb,MAAM,WAAW,MAAM,OAAO,SAAS,CAAC,MAAM,CAAC;gBAC3C,UAAU;oBAAE;gBAAS;YACzB;YACA,aAAa,SAAS,EAAE;YACxB,KAAK,gBAAgB,GAAG;YACxB,MAAM,KAAK,IAAI;QACnB;QAEA,0BAA0B;QAC1B,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YAClD,UAAU;YACV,sBAAsB;gBAAC;aAAO;YAC9B,YAAY;gBAAC;oBACT,YAAY;wBACR,UAAU;wBACV,cAAc;4BACV,MAAM;4BACN,aAAa;wBACjB;wBACA,aAAa;wBACb,WAAW;4BAAE,UAAU;wBAAQ;oBACnC;oBACA,UAAU;gBACd;aAAE;YACF,MAAM;YACN,aAAa,GAAG,QAAQ,GAAG,CAAC,mBAAmB,CAAC,iDAAiD,CAAC;YAClG,YAAY,GAAG,QAAQ,GAAG,CAAC,mBAAmB,CAAC,sBAAsB,CAAC;YACtE,UAAU;gBAAE;YAAS;QACzB;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,WAAW,QAAQ,EAAE;QAAC;IACjD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC;IAChD;AACJ"}}]
}