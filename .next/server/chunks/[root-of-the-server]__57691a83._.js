module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},73752,(e,t,r)=>{t.exports=e.x("stripe-1f8147ac105b0fee",()=>require("stripe-1f8147ac105b0fee"))},86496,e=>{"use strict";var t=e.i(21065),r=e.i(87456),s=e.i(82414),i=e.i(18079);let a=e.r(73752),{userModal:n}=e.r(82094),o=new a(process.env.STRIPE_SECRET_KEY);async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{username:r}=e.body;if(!r)return t.status(400).json({error:"Username is required"});let s=await n.findOne({username:r});if(!s)return t.status(404).json({error:"User not found"});let i=s.stripeCustomerId;i||(s.stripeCustomerId=i=(await o.customers.create({metadata:{username:r}})).id,await s.save());let a=await o.checkout.sessions.create({customer:i,payment_method_types:["card"],line_items:[{price_data:{currency:"inr",product_data:{name:"DesiNGL Pro",description:"Premium features including sender hints and priority support"},unit_amount:9900,recurring:{interval:"month"}},quantity:1}],mode:"subscription",success_url:`${process.env.NEXT_PUBLIC_APP_URL}/premium/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${process.env.NEXT_PUBLIC_APP_URL}/premium?canceled=true`,metadata:{username:r}});t.status(200).json({sessionId:a.id})}catch(e){console.error("Stripe checkout error:",e),t.status(500).json({error:e.message})}}e.s(["default",()=>u],61267);var d=e.i(61267),l=e.i(26156),c=e.i(45105),p=e.i(87409);let m=(0,i.hoist)(d,"default"),h=(0,i.hoist)(d,"config"),f=new s.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/stripe/create-checkout-session",pathname:"/api/stripe/create-checkout-session",bundlePath:"",filename:""},userland:d,distDir:".next",relativeProjectDir:""});async function v(e,r,s){f.isDev&&(0,p.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/stripe/create-checkout-session";i=i.replace(/\/index$/,"")||"/";let a=await f.prepare(e,r,{srcPage:i});if(!a){r.statusCode=400,r.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve());return}let{query:n,params:o,prerenderManifest:u,routerServerContext:d}=a;try{let t=e.method||"GET",s=(0,l.getTracer)(),a=s.getActiveScopeSpan(),p=f.instrumentationOnRequestError.bind(f),m=async a=>f.render(e,r,{query:{...n,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:f.isDev,page:"/api/stripe/create-checkout-session",internalRevalidate:null==d?void 0:d.revalidate,onError:(...t)=>p(e,...t)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${t} ${n}`;a.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),a.updateName(e)}else a.updateName(`${t} ${i}`)});a?await m(a):await s.withPropagatedContext(e.headers,()=>s.trace(c.BaseServerSpan.handleRequest,{spanName:`${t} ${i}`,kind:l.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},m))}catch(e){if(f.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==s.waitUntil||s.waitUntil.call(s,Promise.resolve())}}e.s(["config",0,h,"default",0,m,"handler",()=>v],86496)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__57691a83._.js.map